<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            direction: rtl;
        }

        .header {
            background: white;
            padding: 15px 40px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .notification-icon {
            width: 40px;
            height: 40px;
            background: #ff5252;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
        }

        .search-icon {
            font-size: 20px;
            cursor: pointer;
            color: #666;
        }

        .container {
            display: flex;
            min-height: calc(100vh - 70px);
        }

        .sidebar {
            width: 250px;
            background: white;
            padding: 20px 0;
            box-shadow: 2px 0 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        .menu-item {
            padding: 15px 30px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s;
            color: #666;
            text-decoration: none;
            border: none;
            background: none;
            width: 100%;
            text-align: right;
        }

        .menu-item:hover {
            background: #f5f5f5;
        }

        .menu-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            margin: 0 10px;
        }

        .menu-item .icon {
            width: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .main-content {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
        }

        .page-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .page-header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn-success {
            background: #4caf50;
            color: white;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .form-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .form-card h2 {
            text-align: center;
            margin-bottom: 25px;
            color: #2c3e50;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-block {
            width: 100%;
        }

        .list-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .list-card h2 {
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .appointment-item {
            padding: 20px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .appointment-item:last-child {
            border-bottom: none;
        }

        .appointment-info h3 {
            margin-bottom: 5px;
            color: #2c3e50;
        }

        .appointment-date {
            color: #999;
            font-size: 14px;
        }

        .appointment-actions {
            display: flex;
            gap: 10px;
        }

        .btn-sm {
            padding: 8px 12px;
            font-size: 14px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state i {
            font-size: 60px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
            }
            .sidebar .menu-item span {
                display: none;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-left">
            <h2>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</h2>
        </div>
        <div class="header-right">
            <div class="user-info">
                <span id="userName">Ù…Ø±Ø­Ø¨Ø§Ù‹</span>
                <div class="user-avatar" id="userAvatar">A</div>
            </div>
            <div class="notification-icon">
                <i class="fas fa-bell"></i>
            </div>
            <div class="search-icon">
                <i class="fas fa-search"></i>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="sidebar">
            <div class="menu-item">
                <div class="icon"><i class="fas fa-chart-line"></i></div>
                <span>Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</span>
            </div>
            <div class="menu-item">
                <div class="icon"><i class="fas fa-wallet"></i></div>
                <span>Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</span>
            </div>
            <div class="menu-item active">
                <div class="icon"><i class="fas fa-calendar-alt"></i></div>
                <span>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</span>
            </div>
            <div class="menu-item">
                <div class="icon"><i class="fas fa-bell"></i></div>
                <span>ØªØ°ÙƒÙŠØ±Ø§Øª</span>
            </div>
            <div class="menu-item">
                <div class="icon"><i class="fas fa-robot"></i></div>
                <span>Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</span>
            </div>
            <div class="menu-item">
                <div class="icon"><i class="fas fa-cog"></i></div>
                <span>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
            </div>
            <div class="menu-item">
                <div class="icon"><i class="fas fa-sign-out-alt"></i></div>
                <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
            </div>
        </div>

        <div class="main-content">
            <div class="page-header">
                <h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</h1>
            </div>

            <div class="form-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h2 style="margin: 0;">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¹Ø¯ Ø¬Ø¯ÙŠØ¯</h2>
                    <button class="btn btn-success" onclick="toggleVoiceAppointment()" id="voiceBtn">
                        <i class="fas fa-microphone"></i>
                        ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠ
                    </button>
                </div>
                
                <form id="appointmentForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ÙˆØ¹Ø¯ *</label>
                            <input type="text" id="title" placeholder="Ù…Ø«Ø§Ù„: Ø§Ø¬ØªÙ…Ø§Ø¹ Ø¹Ù…Ù„" required>
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„ØªØ§Ø±ÙŠØ® *</label>
                            <input type="date" id="date" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Ø§Ù„ÙˆÙ‚Øª *</label>
                            <input type="time" id="time" required>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="enableReminder" onchange="toggleReminderEmail()" style="width: auto; margin-left: 8px;">
                                ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ°ÙƒÙŠØ± Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
                            </label>
                        </div>
                    </div>

                    <div class="form-group" id="emailField" style="display: none;">
                        <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ù„ØªØ°ÙƒÙŠØ± *</label>
                        <input type="email" id="reminderEmail" placeholder="example@email.com">
                    </div>

                    <div class="form-group">
                        <label>ÙˆØµÙ Ø§Ù„Ù…ÙˆØ¹Ø¯</label>
                        <textarea id="description" rows="3" placeholder="ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©..."></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary btn-block">
                        <i class="fas fa-plus"></i>
                        Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¹Ø¯
                    </button>
                </form>
            </div>

            <div class="list-card">
                <h2>Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h2>
                <div id="appointmentsList">
                    <div class="empty-state">
                        <i class="fas fa-calendar-times"></i>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯</p>
                        <small>Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¹Ø¯Ùƒ Ø§Ù„Ø£ÙˆÙ„!</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/app.js"></script>
    <script>
        let recognition;
        let isRecording = false;

        function toggleReminderEmail() {
            const checkbox = document.getElementById('enableReminder');
            const emailField = document.getElementById('emailField');
            const emailInput = document.getElementById('reminderEmail');
            
            if (checkbox.checked) {
                emailField.style.display = 'block';
                emailInput.required = true;
            } else {
                emailField.style.display = 'none';
                emailInput.required = false;
                emailInput.value = '';
            }
        }

        document.getElementById('appointmentForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const enableReminder = document.getElementById('enableReminder').checked;
            const appointmentData = {
                title: document.getElementById('title').value,
                date: document.getElementById('date').value,
                time: document.getElementById('time').value,
                description: document.getElementById('description').value,
                reminderEnabled: enableReminder,
                reminderEmail: enableReminder ? document.getElementById('reminderEmail').value : null
            };
            
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_URL}/appointments`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(appointmentData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø¨Ù†Ø¬Ø§Ø­!');
                    this.reset();
                    document.getElementById('enableReminder').checked = false;
                    toggleReminderEmail();
                    await loadAppointments();
                } else {
                    alert('âŒ ' + (data.message || 'Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¹Ø¯'));
                }
            } catch (error) {
                console.error('Error:', error);
                alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¹Ø¯');
            }
        });

        async function loadAppointments() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_URL}/appointments`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                const data = await response.json();
                if (data.success) displayAppointments(data.appointments);
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function displayAppointments(appointments) {
            const container = document.getElementById('appointmentsList');
            
            if (!appointments || appointments.length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-calendar-times"></i><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯</p></div>';
                return;
            }
            
            const html = appointments.map(apt => `
                <div class="appointment-item">
                    <div class="appointment-info">
                        <h3>${apt.title}</h3>
                        <div class="appointment-date">
                            <i class="fas fa-calendar"></i> ${new Date(apt.date).toLocaleDateString('ar-SA')}
                            <i class="fas fa-clock" style="margin-right: 15px;"></i> ${apt.time}
                            ${apt.reminderEnabled ? '<i class="fas fa-envelope" style="margin-right: 15px; color: #4caf50;"></i>' : ''}
                        </div>
                        ${apt.description ? `<p style="margin-top: 5px; color: #666;">${apt.description}</p>` : ''}
                    </div>
                    <div class="appointment-actions">
                        ${apt.reminderEnabled && apt.reminderEmail ? `
                            <button class="btn btn-success btn-sm" onclick="sendEmailReminder('${apt._id}')">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        ` : ''}
                        <button class="btn btn-danger btn-sm" onclick="deleteAppointment('${apt._id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }

        async function deleteAppointment(id) {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¹Ø¯ØŸ')) return;
            
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_URL}/appointments/${id}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if ((await response.json()).success) {
                    alert('âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù');
                    loadAppointments();
                }
            } catch (error) {
                alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù');
            }
        }

        async function sendEmailReminder(id) {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_URL}/appointments/${id}/email-reminder`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                const data = await response.json();
                alert(data.success ? 'âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ°ÙƒÙŠØ±' : 'âŒ ' + data.message);
            } catch (error) {
                alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ°ÙƒÙŠØ±');
            }
        }

        function toggleVoiceAppointment() {
            if (!('webkitSpeechRecognition' in window)) {
                alert('âŒ Ø§Ø³ØªØ®Ø¯Ù… Chrome Ù„Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ');
                return;
            }
            isRecording ? stopRecording() : startRecording();
        }

function startRecording() {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SpeechRecognition();
    recognition.lang = 'ar-SA';
    recognition.continuous = false;
    
    recognition.onstart = () => {
        isRecording = true;
        const btn = document.getElementById('voiceBtn');
        btn.innerHTML = '<i class="fas fa-stop"></i> Ø¥ÙŠÙ‚Ø§Ù';
        btn.style.background = '#f44336';
        alert('ğŸ¤ Ø§Ø¨Ø¯Ø£ Ø§Ù„ÙƒÙ„Ø§Ù… Ø§Ù„Ø¢Ù†...');
    };
    
    recognition.onresult = async (event) => {
        const text = event.results[0][0].transcript;
        console.log('âœ… ØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰:', text);
        
        // Ù…Ù„Ø¡ Ø­Ù‚Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
        document.getElementById('title').value = text;
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¹Ø¯ Ù…Ø¨Ø§Ø´Ø±Ø©
        const today = new Date().toISOString().split('T')[0];
        const now = new Date().toTimeString().split(' ')[0].substring(0, 5);
        
        const appointmentData = {
            title: text,
            date: document.getElementById('date').value || today,
            time: document.getElementById('time').value || now,
            description: 'ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ù„ØµÙˆØª',
            reminderEnabled: false
        };
        
        try {
            const token = localStorage.getItem('token');
            const response = await fetch(`${API_URL}/appointments`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify(appointmentData)
            });
            
            const data = await response.json();
            
            if (data.success) {
                alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¹Ø¯: ' + text);
                document.getElementById('appointmentForm').reset();
                await loadAppointments();
            } else {
                alert('âŒ Ø®Ø·Ø£: ' + data.message);
            }
        } catch (error) {
            console.error('Error:', error);
            alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¹Ø¯');
        }
    };
    
    recognition.onerror = (event) => {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„:', event.error);
        alert('âŒ Ø®Ø·Ø£: ' + event.error);
        stopRecording();
    };
    
    recognition.onend = () => {
        stopRecording();
    };
    
    try {
        recognition.start();
    } catch (error) {
        alert('âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„: ' + error.message);
        stopRecording();
    }
}

        document.addEventListener('DOMContentLoaded', loadAppointments);
    </script>
</body>
</html>