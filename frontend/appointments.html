<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</title>
    
    <!-- Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ -->
    <link rel="stylesheet" href="css/style.css">
    
    <!-- ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ -->
    <link rel="stylesheet" href="css/mobile.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            direction: rtl;
        }

        .header {
            background: white;
            padding: 15px 40px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-left h2 {
            font-size: 20px;
            color: #2c3e50;
        }

        .menu-toggle {
            display: none;
            font-size: 24px;
            cursor: pointer;
            color: #667eea;
            background: none;
            border: none;
            padding: 5px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .notification-icon {
            width: 40px;
            height: 40px;
            background: #ff5252;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
        }

        .search-icon {
            font-size: 20px;
            cursor: pointer;
            color: #666;
        }

        .container {
            display: flex;
            min-height: calc(100vh - 70px);
        }

        .sidebar {
            width: 250px;
            background: white;
            padding: 20px 0;
            box-shadow: 2px 0 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
        }

        .sidebar-overlay {
            display: none;
        }

        .menu-item {
            padding: 15px 30px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s;
            color: #666;
            text-decoration: none;
            border: none;
            background: none;
            width: 100%;
            text-align: right;
        }

        .menu-item:hover {
            background: #f5f5f5;
        }

        .menu-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            margin: 0 10px;
        }

        .menu-item .icon {
            width: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .main-content {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
        }

        .page-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .page-header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn-success {
            background: #4caf50;
            color: white;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .form-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .form-card h2 {
            text-align: center;
            margin-bottom: 25px;
            color: #2c3e50;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-block {
            width: 100%;
        }

        .list-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .list-card h2 {
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .appointment-item {
            padding: 20px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .appointment-item:last-child {
            border-bottom: none;
        }

        .appointment-info h3 {
            margin-bottom: 5px;
            color: #2c3e50;
        }

        .appointment-date {
            color: #999;
            font-size: 14px;
        }

        .appointment-actions {
            display: flex;
            gap: 10px;
        }

        .btn-sm {
            padding: 8px 12px;
            font-size: 14px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state i {
            font-size: 60px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .form-header h2 {
            margin: 0;
        }
    </style>
</head>
<body>
    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

    <!-- Header -->
    <div class="header">
        <div class="header-left">
            <button class="menu-toggle" onclick="toggleSidebar()">
                <i class="fas fa-bars"></i>
            </button>
            <h2>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</h2>
        </div>
        <div class="header-right">
            <div class="search-icon">
                <i class="fas fa-search"></i>
            </div>
            <div class="notification-icon">
                <i class="fas fa-bell"></i>
            </div>
            <div class="user-info">
                <span id="userName">Ù…Ø±Ø­Ø¨Ø§Ù‹</span>
                <div class="user-avatar" id="userAvatar">A</div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <a href="app.html" class="menu-item">
                <div class="icon"><i class="fas fa-chart-line"></i></div>
                <span>Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</span>
            </a>
            <a href="expenses.html" class="menu-item">
                <div class="icon"><i class="fas fa-wallet"></i></div>
                <span>Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</span>
            </a>
            <a href="appointments.html" class="menu-item active">
                <div class="icon"><i class="fas fa-calendar-alt"></i></div>
                <span>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</span>
            </a>
            <a href="reminders.html" class="menu-item">
                <div class="icon"><i class="fas fa-bell"></i></div>
                <span>ØªØ°ÙƒÙŠØ±Ø§Øª</span>
            </a>
            <a href="ai.html" class="menu-item">
                <div class="icon"><i class="fas fa-robot"></i></div>
                <span>Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</span>
            </a>
            <a href="settings.html" class="menu-item">
                <div class="icon"><i class="fas fa-cog"></i></div>
                <span>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
            </a>
            <button class="menu-item" onclick="logout()">
                <div class="icon"><i class="fas fa-sign-out-alt"></i></div>
                <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
            </button>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="page-header">
    <h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</h1>
    <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 10px;">
        <button class="btn btn-success" onclick="toggleVoiceAppointment()" id="voiceBtn">
            <i class="fas fa-microphone"></i>
            <span>Ø§Ø¶Ø§ÙØ© Ù…ÙˆØ¹Ø¯ Ù…Ù† Ø®Ù„Ø§Ù„ ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠ</span>
        </button>
        <div id="recordingIndicator" style="display: none; color: #f44336; font-weight: 600; font-size: 14px; animation: pulse 1.5s infinite;">
            <i class="fas fa-circle" style="font-size: 8px; margin-left: 8px;"></i>
            Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„... <span id="recordingTimer">0</span>Ø«
        </div>
    </div>
</div>

<div class="form-card">
    <h2 style="text-align: center; margin-bottom: 25px;">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¹Ø¯ Ø¬Ø¯ÙŠØ¯</h2>
                
                <form id="appointmentForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ÙˆØ¹Ø¯ *</label>
                            <input type="text" id="title" placeholder="Ù…Ø«Ø§Ù„: Ø§Ø¬ØªÙ…Ø§Ø¹ Ø¹Ù…Ù„" required>
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„ØªØ§Ø±ÙŠØ® *</label>
                            <input type="date" id="date" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Ø§Ù„ÙˆÙ‚Øª *</label>
                            <input type="time" id="time" required>
                        </div>
                   <div class="form-group">
    <label for="timezone">
        <i class="fas fa-globe"></i>
        Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©
    </label>
    <select id="timezone" name="timezone" class="form-control">
        <optgroup label="Ø£ÙØ±ÙŠÙ‚ÙŠØ§">
            <option value="Africa/Cairo">Ø§Ù„Ù‚Ø§Ù‡Ø±Ø© (GMT+2)</option>
            <option value="Africa/Casablanca">Ø§Ù„Ø¯Ø§Ø± Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ (GMT+1)</option>
            <option value="Africa/Johannesburg">Ø¬ÙˆÙ‡Ø§Ù†Ø³Ø¨Ø±Øº (GMT+2)</option>
            <option value="Africa/Lagos">Ù„Ø§ØºÙˆØ³ (GMT+1)</option>
            <option value="Africa/Nairobi">Ù†ÙŠØ±ÙˆØ¨ÙŠ (GMT+3)</option>
        </optgroup>
        
        <optgroup label="Ø¢Ø³ÙŠØ§">
            <option value="Asia/Riyadh">Ø§Ù„Ø±ÙŠØ§Ø¶ (GMT+3)</option>
            <option value="Asia/Dubai">Ø¯Ø¨ÙŠ (GMT+4)</option>
            <option value="Asia/Kuwait">Ø§Ù„ÙƒÙˆÙŠØª (GMT+3)</option>
            <option value="Asia/Bahrain">Ø§Ù„Ø¨Ø­Ø±ÙŠÙ† (GMT+3)</option>
            <option value="Asia/Qatar">Ù‚Ø·Ø± (GMT+3)</option>
            <option value="Asia/Muscat">Ù…Ø³Ù‚Ø· (GMT+4)</option>
            <option value="Asia/Baghdad">Ø¨ØºØ¯Ø§Ø¯ (GMT+3)</option>
            <option value="Asia/Damascus">Ø¯Ù…Ø´Ù‚ (GMT+2)</option>
            <option value="Asia/Beirut">Ø¨ÙŠØ±ÙˆØª (GMT+2)</option>
            <option value="Asia/Amman">Ø¹Ù…Ù‘Ø§Ù† (GMT+2)</option>
            <option value="Asia/Jerusalem">Ø§Ù„Ù‚Ø¯Ø³ (GMT+2)</option>
            <option value="Asia/Tehran">Ø·Ù‡Ø±Ø§Ù† (GMT+3:30)</option>
            <option value="Asia/Karachi">ÙƒØ±Ø§ØªØ´ÙŠ (GMT+5)</option>
            <option value="Asia/Kolkata">Ù†ÙŠÙˆØ¯Ù„Ù‡ÙŠ (GMT+5:30)</option>
            <option value="Asia/Dhaka">Ø¯ÙƒØ§ (GMT+6)</option>
            <option value="Asia/Bangkok">Ø¨Ø§Ù†ÙƒÙˆÙƒ (GMT+7)</option>
            <option value="Asia/Singapore">Ø³Ù†ØºØ§ÙÙˆØ±Ø© (GMT+8)</option>
            <option value="Asia/Hong_Kong">Ù‡ÙˆÙ†Øº ÙƒÙˆÙ†Øº (GMT+8)</option>
            <option value="Asia/Shanghai">Ø´Ù†ØºÙ‡Ø§ÙŠ (GMT+8)</option>
            <option value="Asia/Tokyo">Ø·ÙˆÙƒÙŠÙˆ (GMT+9)</option>
            <option value="Asia/Seoul">Ø³ÙŠÙˆÙ„ (GMT+9)</option>
        </optgroup>
        
        <optgroup label="Ø£ÙˆØ±ÙˆØ¨Ø§">
            <option value="Europe/Berlin" selected>Ø¨Ø±Ù„ÙŠÙ† (GMT+1)</option>
            <option value="Europe/London">Ù„Ù†Ø¯Ù† (GMT+0)</option>
            <option value="Europe/Paris">Ø¨Ø§Ø±ÙŠØ³ (GMT+1)</option>
            <option value="Europe/Rome">Ø±ÙˆÙ…Ø§ (GMT+1)</option>
            <option value="Europe/Madrid">Ù…Ø¯Ø±ÙŠØ¯ (GMT+1)</option>
            <option value="Europe/Amsterdam">Ø£Ù…Ø³ØªØ±Ø¯Ø§Ù… (GMT+1)</option>
            <option value="Europe/Brussels">Ø¨Ø±ÙˆÙƒØ³Ù„ (GMT+1)</option>
            <option value="Europe/Vienna">ÙÙŠÙŠÙ†Ø§ (GMT+1)</option>
            <option value="Europe/Stockholm">Ø³ØªÙˆÙƒÙ‡ÙˆÙ„Ù… (GMT+1)</option>
            <option value="Europe/Moscow">Ù…ÙˆØ³ÙƒÙˆ (GMT+3)</option>
            <option value="Europe/Istanbul">Ø¥Ø³Ø·Ù†Ø¨ÙˆÙ„ (GMT+3)</option>
        </optgroup>
        
        <optgroup label="Ø£Ù…Ø±ÙŠÙƒØ§ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ©">
            <option value="America/New_York">Ù†ÙŠÙˆÙŠÙˆØ±Ùƒ (GMT-5)</option>
            <option value="America/Chicago">Ø´ÙŠÙƒØ§ØºÙˆ (GMT-6)</option>
            <option value="America/Denver">Ø¯Ù†ÙØ± (GMT-7)</option>
            <option value="America/Los_Angeles">Ù„ÙˆØ³ Ø£Ù†Ø¬Ù„ÙˆØ³ (GMT-8)</option>
            <option value="America/Toronto">ØªÙˆØ±Ù†ØªÙˆ (GMT-5)</option>
            <option value="America/Vancouver">ÙØ§Ù†ÙƒÙˆÙØ± (GMT-8)</option>
            <option value="America/Mexico_City">Ù…ÙƒØ³ÙŠÙƒÙˆ Ø³ÙŠØªÙŠ (GMT-6)</option>
        </optgroup>
        
        <optgroup label="Ø£Ù…Ø±ÙŠÙƒØ§ Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠØ©">
            <option value="America/Sao_Paulo">Ø³Ø§Ùˆ Ø¨Ø§ÙˆÙ„Ùˆ (GMT-3)</option>
            <option value="America/Buenos_Aires">Ø¨ÙˆÙŠÙ†Ø³ Ø¢ÙŠØ±Ø³ (GMT-3)</option>
            <option value="America/Bogota">Ø¨ÙˆØºÙˆØªØ§ (GMT-5)</option>
            <option value="America/Lima">Ù„ÙŠÙ…Ø§ (GMT-5)</option>
        </optgroup>
        
        <optgroup label="Ø£ÙˆÙ‚ÙŠØ§Ù†ÙˆØ³ÙŠØ§">
            <option value="Australia/Sydney">Ø³ÙŠØ¯Ù†ÙŠ (GMT+11)</option>
            <option value="Australia/Melbourne">Ù…Ù„Ø¨ÙˆØ±Ù† (GMT+11)</option>
            <option value="Pacific/Auckland">Ø£ÙˆÙƒÙ„Ø§Ù†Ø¯ (GMT+13)</option>
        </optgroup>
    </select>
</div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="enableReminder" onchange="toggleReminderEmail()" style="width: auto; margin-left: 8px;">
                                ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ°ÙƒÙŠØ± Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
                            </label>
                        </div>
                    </div>

                    <div class="form-group" id="emailField" style="display: none;">
                        <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ù„ØªØ°ÙƒÙŠØ± *</label>
                        <input type="email" id="reminderEmail" placeholder="example@email.com">
                    </div>

                    <div class="form-group">
                        <label>ÙˆØµÙ Ø§Ù„Ù…ÙˆØ¹Ø¯</label>
                        <textarea id="description" rows="3" placeholder="ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©..."></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary btn-block">
                        <i class="fas fa-plus"></i>
                        Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¹Ø¯
                    </button>
                </form>
            </div>

            <div class="list-card">
                <h2>Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h2>
                <div id="appointmentsList">
                    <div class="empty-state">
                        <i class="fas fa-calendar-times"></i>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯</p>
                        <small>Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¹Ø¯Ùƒ Ø§Ù„Ø£ÙˆÙ„!</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/app.js"></script>
<script>
    // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ
    let recognition = null;
    let isRecording = false;
    let recordingTimeout = null;
    let timerInterval = null;
    let recordingSeconds = 0;

    // Toggle Sidebar
    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebarOverlay');
        
        if (sidebar) sidebar.classList.toggle('active');
        if (overlay) overlay.classList.toggle('active');
    }

    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± ØµÙØ­Ø©
    document.addEventListener('DOMContentLoaded', function() {
        const menuItems = document.querySelectorAll('.menu-item');
        
        menuItems.forEach(item => {
            item.addEventListener('click', function() {
                if (window.innerWidth <= 768) {
                    toggleSidebar();
                }
            });
        });

        loadAppointments();
    });

    // Logout
    function logout() {
        if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = 'index.html';
        }
    }

    // ØªØ¨Ø¯ÙŠÙ„ Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
    function toggleReminderEmail() {
        const checkbox = document.getElementById('enableReminder');
        const emailField = document.getElementById('emailField');
        const emailInput = document.getElementById('reminderEmail');
        
        if (checkbox.checked) {
            emailField.style.display = 'block';
            emailInput.required = true;
        } else {
            emailField.style.display = 'none';
            emailInput.required = false;
            emailInput.value = '';
        }
    }

    // Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¹Ø¯
document.getElementById('appointmentForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const enableReminder = document.getElementById('enableReminder').checked;
    const appointmentData = {
        title: document.getElementById('title').value,
        date: document.getElementById('date').value,
        time: document.getElementById('time').value,
        description: document.getElementById('description').value,
        reminderEnabled: enableReminder,
        reminderEmail: enableReminder ? document.getElementById('reminderEmail').value : null,
        timezone: document.getElementById('timezone').value || 'Europe/Berlin'
    };
        
        try {
            const token = localStorage.getItem('token');
            const response = await fetch(`${API_URL}/appointments`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify(appointmentData)
            });
            
            const data = await response.json();
            
            if (data.success) {
                alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø¨Ù†Ø¬Ø§Ø­!');
                this.reset();
                document.getElementById('enableReminder').checked = false;
                toggleReminderEmail();
                await loadAppointments();
            } else {
                alert('âŒ ' + (data.message || 'Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¹Ø¯'));
            }
        } catch (error) {
            console.error('Error:', error);
            alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¹Ø¯');
        }
    });

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯
    async function loadAppointments() {
        try {
            const token = localStorage.getItem('token');
            const response = await fetch(`${API_URL}/appointments`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            
            const data = await response.json();
            if (data.success) displayAppointments(data.appointments);
        } catch (error) {
            console.error('Error:', error);
        }
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯
    function displayAppointments(appointments) {
        const container = document.getElementById('appointmentsList');
        
        if (!appointments || appointments.length === 0) {
            container.innerHTML = '<div class="empty-state"><i class="fas fa-calendar-times"></i><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯</p></div>';
            return;
        }
        
        const html = appointments.map(apt => `
            <div class="appointment-item">
                <div class="appointment-info">
                    <h3>${apt.title}</h3>
                    <div class="appointment-date">
                        <i class="fas fa-calendar"></i> ${new Date(apt.date).toLocaleDateString('ar-SA')}
                        <i class="fas fa-clock" style="margin-right: 15px;"></i> ${apt.time}
                        ${apt.reminderEnabled ? '<i class="fas fa-envelope" style="margin-right: 15px; color: #4caf50;"></i>' : ''}
                    </div>
                    ${apt.description ? `<p style="margin-top: 5px; color: #666;">${apt.description}</p>` : ''}
                </div>
                <div class="appointment-actions">
                    ${apt.reminderEnabled && apt.reminderEmail ? `
                        <button class="btn btn-success btn-sm" onclick="sendEmailReminder('${apt._id}')">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    ` : ''}
                    <button class="btn btn-danger btn-sm" onclick="deleteAppointment('${apt._id}')">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        `).join('');
        
        container.innerHTML = html;
    }

    // Ø­Ø°Ù Ù…ÙˆØ¹Ø¯
    async function deleteAppointment(id) {
        if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¹Ø¯ØŸ')) return;
        
        try {
            const token = localStorage.getItem('token');
            const response = await fetch(`${API_URL}/appointments/${id}`, {
                method: 'DELETE',
                headers: { 'Authorization': `Bearer ${token}` }
            });
            
            if ((await response.json()).success) {
                alert('âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù');
                loadAppointments();
            }
        } catch (error) {
            alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù');
        }
    }

    // Ø¥Ø±Ø³Ø§Ù„ ØªØ°ÙƒÙŠØ± Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯
    async function sendEmailReminder(id) {
        try {
            const token = localStorage.getItem('token');
            const response = await fetch(`${API_URL}/appointments/${id}/email-reminder`, {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${token}` }
            });
            
            const data = await response.json();
            alert(data.success ? 'âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ°ÙƒÙŠØ±' : 'âŒ ' + data.message);
        } catch (error) {
            alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ°ÙƒÙŠØ±');
        }
    }

    // ==========================================
    // Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ
    // ==========================================
    function toggleVoiceAppointment() {
        if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
            alert('âŒ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ\nØ§Ø³ØªØ®Ø¯Ù… Chrome Ø£Ùˆ Edge');
            return;
        }
        
        if (isRecording) {
            stopRecording();
        } else {
            startRecording();
        }
    }

    function startRecording() {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        recognition.lang = 'ar-SA';
        recognition.continuous = false;
        recognition.interimResults = false;
        
        recognition.onstart = () => {
            isRecording = true;
            recordingSeconds = 0;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø²Ø±
            const btn = document.getElementById('voiceBtn');
            btn.style.background = '#f44336';
            btn.innerHTML = '<i class="fas fa-stop"></i> <span>Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„</span>';
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ³Ø¬ÙŠÙ„
            const indicator = document.getElementById('recordingIndicator');
            if (indicator) {
                indicator.style.display = 'flex';
            }
            
            // Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø¯Ø§Ø¯
            timerInterval = setInterval(() => {
                recordingSeconds++;
                const timerEl = document.getElementById('recordingTimer');
                if (timerEl) timerEl.textContent = recordingSeconds;
            }, 1000);
            
            // Ø¥ÙŠÙ‚Ø§Ù ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø¹Ø¯ 15 Ø«Ø§Ù†ÙŠØ©
            recordingTimeout = setTimeout(() => {
                console.log('â±ï¸ Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ (15 Ø«Ø§Ù†ÙŠØ©)');
                stopRecording();
                alert('â±ï¸ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ 15 Ø«Ø§Ù†ÙŠØ©');
            }, 15000);
            
            console.log('ğŸ¤ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...');
        };
        
        recognition.onresult = async (event) => {
            const text = event.results[0][0].transcript;
            console.log('âœ… ØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰:', text);
            
            // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„
            stopRecording();
            
            // Ù…Ù„Ø¡ Ø­Ù‚Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
            document.getElementById('title').value = text;
            
            // ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const today = new Date().toISOString().split('T')[0];
            const now = new Date().toTimeString().split(' ')[0].substring(0, 5);
            
            const appointmentData = {
                title: text,
                date: document.getElementById('date').value || today,
                time: document.getElementById('time').value || now,
                description: 'ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ù„ØµÙˆØª',
                           reminderEnabled: false,
                timezone: document.getElementById('timezone').value || 'Europe/Berlin'

            };
            
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_URL}/appointments`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(appointmentData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¹Ø¯: ' + text);
                    document.getElementById('appointmentForm').reset();
                    await loadAppointments();
                } else {
                    alert('âŒ Ø®Ø·Ø£: ' + data.message);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¹Ø¯');
            }
        };
        
        recognition.onerror = (event) => {
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„:', event.error);
            
            let errorMsg = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„';
            switch(event.error) {
                case 'no-speech':
                    errorMsg = 'Ù„Ù… ÙŠØªÙ… Ø§ÙƒØªØ´Ø§Ù ØµÙˆØªØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰';
                    break;
                case 'audio-capture':
                    errorMsg = 'Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†';
                    break;
                case 'not-allowed':
                    errorMsg = 'ÙŠØ¬Ø¨ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†';
                    break;
                default:
                    errorMsg = event.error;
            }
            
            alert('âŒ ' + errorMsg);
            stopRecording();
        };
        
        recognition.onend = () => {
            if (isRecording) {
                stopRecording();
            }
        };
        
        try {
            recognition.start();
        } catch (error) {
            console.error('âŒ ÙØ´Ù„ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„:', error);
            alert('âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„: ' + error.message);
            stopRecording();
        }
    }

    function stopRecording() {
        isRecording = false;
        
        // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¹Ø¯Ø§Ø¯
        if (timerInterval) {
            clearInterval(timerInterval);
            timerInterval = null;
        }
        
        // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        if (recordingTimeout) {
            clearTimeout(recordingTimeout);
            recordingTimeout = null;
        }
        
        // Ø¥Ø®ÙØ§Ø¡ Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ³Ø¬ÙŠÙ„
        const indicator = document.getElementById('recordingIndicator');
        if (indicator) {
            indicator.style.display = 'none';
        }
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø²Ø± Ù„Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ©
        const btn = document.getElementById('voiceBtn');
        if (btn) {
            btn.style.background = '#4caf50';
            btn.innerHTML = '<i class="fas fa-microphone"></i> <span>Ø§Ø¶Ø§ÙØ© Ù…ÙˆØ¹Ø¯ Ù…Ù† Ø®Ù„Ø§Ù„ ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠ</span>';
        }
        
        // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„
        if (recognition) {
            try {
                recognition.stop();
            } catch (e) {
                console.log('Recognition already stopped');
            }
        }
        
        recordingSeconds = 0;
    }
</script>
</body>
</html>